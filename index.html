<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Revive by Lize — Massage Therapy</title>
<meta name="description" content="Massage therapy for healing, renewal, and radiant relaxation in the Bay Area. Gentle Recovery Flow, Total Body Renewal, Radiance Facial Flow.">
<style>
  /* Fade-in animation for sections */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(32px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .fadein {
    opacity: 0;
    animation: fadeInUp 0.9s cubic-bezier(.35,1.3,.5,1) forwards;
  }
  /* Stagger effect for testimonials cards */
  .testimonials .card {
    opacity: 0;
    animation: fadeInUp 0.8s cubic-bezier(.35,1.3,.5,1) forwards;
  }
  .testimonials .card:nth-child(1) { animation-delay: 0.1s; }
  .testimonials .card:nth-child(2) { animation-delay: 0.25s; }
  .testimonials .card:nth-child(3) { animation-delay: 0.4s; }

  /* Testimonials grid */
  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 22px;
    margin-top: 18px;
  }
  @media (max-width: 900px) {
    .testimonials-grid {
      grid-template-columns: 1fr;
    }
  }
  .testimonial-author {
    font-weight: 600;
    margin-top: 14px;
    color: var(--accent);
    font-size: 16px;
  }
  .testimonial-quote {
    font-style: italic;
    color: var(--muted);
    margin-bottom: 4px;
  }

  /* Sticky Book Now button */
  .booknow-fab {
    position: fixed;
    right: 28px;
    bottom: 28px;
    z-index: 99;
    background: var(--deep-2);
    color: #fff;
    font-weight: 700;
    border: none;
    border-radius: 999px;
    padding: 16px 28px;
    box-shadow: 0 2px 20px rgba(31,41,55,0.18);
    cursor: pointer;
    font-size: 18px;
    transition: background 0.18s;
    outline: none;
  }
  .booknow-fab:hover {
    background: #111827;
  }
  :root{--bg:#fbfbfb;--ink:#1f2937;--muted:#6b7280;--accent:#5fa08e;--accent-2:#cfe3dc;--card:#ffffff;--ok:#16a34a;--no:#ef4444;--deep-1:#0f172a;--deep-2:#1f2937}
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;color:var(--ink);background:var(--bg);line-height:1.6}
  img{max-width:100%;display:block}
  .container{max-width:1120px;margin:0 auto;padding:0 20px}
  section{padding:72px 20px}
  h1,h2{margin:0 0 14px}
  h1{font-size:44px;line-height:1.15}
  h2{font-size:28px}
  .sub{color:var(--muted)}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:18px;box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

  /* Header */
  .topbar{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid #e5e7eb;backdrop-filter:saturate(180%) blur(8px)}
  .brand{font-weight:800;letter-spacing:.3px;padding:16px 0}
  nav{display:flex;gap:12px;flex-wrap:wrap}
  nav a{color:var(--ink);text-decoration:none;font-weight:500;padding:10px 12px;border-radius:999px}
  nav a:hover{background:#f3f4f6}
  nav a.cta{background:var(--deep-2);color:#fff;padding:10px 16px}

  /* Nav dropdown */
  .dropdown{position:relative}
  .drop-trigger{display:inline-block}
  .dropdown-menu{
    position:absolute;left:0;top:100%;
    display:none;list-style:none;margin:6px 0 0;padding:8px;
    background:#fff;border:1px solid #e5e7eb;border-radius:10px;min-width:220px;z-index:30;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .dropdown:hover .dropdown-menu,
  .dropdown:focus-within .dropdown-menu{display:block}
  .dropdown-menu .dropdown-link{
    display:block;padding:8px 10px;border-radius:8px;color:var(--ink);text-decoration:none;font-weight:500;
  }
  .dropdown-menu .dropdown-link:hover{background:#f3f4f6}

  /* Hero (full-bleed background video) */
  .hero{padding:0;background:#000}
  .hero-inner{padding:0;display:block}
  .hero p{color:var(--muted);font-size:18px;margin:0 0 24px}
  .btn{display:inline-block;text-decoration:none;font-weight:600;padding:12px 18px;border-radius:999px}
  .btn.primary{background:var(--deep-2);color:#fff}
  .btn.secondary{background:#fff;color:var(--ink);border:1px solid #e5e7eb}
  .hero-visual{position:relative;height:100svh;min-height:520px;border-radius:0;overflow:hidden;box-shadow:none;background:#000}
  .hero-visual video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:50% 50%}
  .hero-visual::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,.35)}

  @media (max-width: 640px){
    /* Use intrinsic sizing on phones to prevent vertical crop */
    .hero-visual{
      height:auto;
      min-height:0;       /* remove desktop min-height that created the big black box */
      background:#000;
    }
    /* Hide the dim overlay on mobile to avoid extra black area */
    .hero-visual::after{display:none}
    .hero-visual video{
      position:static; /* remove absolute fill */
      display:block;
      width:100%;
      height:auto;
      max-height:100svh; /* cap to viewport height */
      object-fit:contain; /* show entire frame; may letterbox */
      object-position:center center;
      background:#000;
    }
  }

  /* Intro (slogan + CTAs on dark monotone gradient) */
  .intro{background:linear-gradient(135deg,#0f172a,#1f2937);color:#e5e7eb}
  .intro h1{color:#ffffff}
  .intro .sub, .intro p{color:#cbd5e1}
  .intro .btn.primary{background:var(--deep-2);color:#ffffff}
  .intro .btn.secondary{background:transparent;color:#ffffff;border:1px solid rgba(255,255,255,.35)}
  .intro .btn.secondary:hover{background:rgba(255,255,255,.06)}

  /* Services */
  .services{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:16px}
  @media(max-width:980px){.hero-inner{grid-template-columns:1fr}.services{grid-template-columns:1fr}}
  .card h3{margin:0 0 6px;font-size:18px}
  .visual{height:180px;border-radius:12px;margin-bottom:12px;overflow:hidden;background:#eee}
  .visual img{width:100%;height:100%;object-fit:cover}
  .price{font-weight:700;margin-top:8px}

  /* About */
  .about{display:grid;grid-template-columns:1fr 1.15fr;gap:24px;margin-top:18px}
  @media(max-width:980px){.about{grid-template-columns:1fr}}
  .about-visual{border-radius:14px;min-height:280px;overflow:hidden;background:#f1f5f9}
  .about-visual img{width:100%;height:100%;object-fit:cover;display:block}

  /* Booking calendar */
  .calendar{display:grid;gap:12px}
  .cal-head{display:flex;justify-content:space-between;align-items:center}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .dow{font-size:12px;color:#6b7280;text-align:center}
  .day{padding:12px;border-radius:10px;text-align:center;border:1px solid #e5e7eb;background:#fff;cursor:pointer;user-select:none}
  .day.muted{color:#9ca3af;background:#f9fafb}
  .day.ok{border-color:#86efac;background:#ecfdf5}
  .day.no{border-color:#fecaca;background:#fff1f2}
  .day.selected{outline:3px solid #5fa08e}
  .cal-legend{display:flex;gap:10px;align-items:center;font-size:12px;color:#6b7280;margin-top:8px}
  .chip{display:inline-block;width:12px;height:12px;border-radius:3px;margin-right:6px}
  .chip.ok{background:#22c55e}
  .chip.no{background:#ef4444}

  /* Footer */
  footer{background:#fff;border-top:1px solid #e5e7eb;color:#4b5563;margin-top:40px}
  .footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr;gap:18px;padding:22px 0}
  @media(max-width:980px){.footer-grid{grid-template-columns:1fr}}
  .small{font-size:13px;color:#6b7280}
  .credits{border-top:1px solid #e5e7eb;margin-top:24px;padding:16px 0;font-size:12px;text-align:center}
</style>
</head>
<body>
<header class="topbar">
  <div class="container row">
    <div class="brand">Revive by Lize</div>
    <nav>
      <div class="dropdown">
        <a href="#services" class="drop-trigger">Services</a>
        <ul class="dropdown-menu">
          <li><a href="#services" class="dropdown-link">Signature Massages</a></li>
          <li><a href="#services" class="dropdown-link">Recovery &amp; Wellness</a></li>
        </ul>
      </div>
      <a href="#about">About</a>
      <a href="#booking">Book</a>
      <a href="/policies.html">Policies</a>
      <a href="#contact">Contact</a>
      <a class="cta" href="mailto:contact@revivebylize.com">Email</a>
    </nav>
  </div>
</header>


<section class="hero" aria-label="Hero video">
  <div class="hero-visual">
    <video class="hero-video" autoplay muted loop playsinline preload="metadata">
      <source src="assets/videos/massage-hero.mp4" type="video/mp4" />
    </video>
  </div>
</section>

<section class="intro">
  <div class="container" style="padding:64px 20px">
    <h1>Healing hands. Restoring balance.</h1>
    <p class="sub">Massage therapy crafted with care for recovery, renewal, and radiant relaxation.</p>
    <a class="btn primary" href="#booking">Book an Appointment</a>
    <a class="btn secondary" href="#services">See Services</a>
  </div>
</section>

<section id="services" class="container fadein">
  <h2>Services</h2>
  <div class="sub">Fair, accessible pricing — quality care without $100/hour price tags.</div>
  <div class="services">
    <div class="card">
      <div class="visual"><img src="GRF.png" alt="Tailored to You — Lifestyle by Lize"></div>
      <h3>Tailored to You — Lifestyle by Lize</h3>
      <div class="price">$110 • 60–75 min</div>
      <p class="summary">A full‑body deep relaxation experience tailored to you. This isn’t a routine — it’s a humanized session that flows with what your body needs that day.</p>
      <div class="more" style="display:none">
        <p>It’s about connection, presence, and restoring your natural rhythm. Each session is uniquely adjusted — sometimes slower, sometimes more stimulating — dedicated just for you.</p>
      </div>
      <button class="btn secondary view-more" data-target="0">View more</button>
    </div>

    <div class="card">
      <div class="visual"><img src="TBR.png" alt="Lymphatic Flow"></div>
      <h3>Lymphatic Flow</h3>
      <div class="price">$125 • 60–75 min</div>
      <p class="summary">A gentle, rhythmic full‑body massage that encourages natural lymph movement — supporting detoxification, balance, and overall wellness.</p>
      <div class="more" style="display:none">
        <p>Combining traditional manual drainage principles with a humanized approach focused on comfort and awareness. Each session stimulates circulation, helps reduce water retention, and restores lightness to the body.</p>
      </div>
      <button class="btn secondary view-more" data-target="1">View more</button>
    </div>

    <div class="card">
      <div class="visual"><img src="RFF.png" alt="Post‑Procedure Lymphatic Flow"></div>
      <h3>Post‑Procedure Lymphatic Flow</h3>
      <div class="price">$145 • 45–60 min</div>
      <p class="summary">Specialized recovery care designed to support the body after surgery or cosmetic procedures — with an ultra‑gentle, restorative flow.</p>
      <div class="more" style="display:none">
        <p>The technique adapts for healing tissues to help reduce swelling, prevent fibrosis, and improve comfort during recovery. Available in‑studio or in‑home, always with humanized care that follows your healing rhythm.</p>
      </div>
      <button class="btn secondary view-more" data-target="2">View more</button>
    </div>
  </div>
</section>

<section id="about" class="container fadein">
  <h2>About Lize</h2>
  <div class="about">
    <div class="about-visual">
      <img src="assets/images/about/mom.jpg" alt="Lize — licensed massage therapist in San Jose" />
    </div>
    <div>
      <p>Lize is a licensed massage therapist serving the South Bay. She blends Swedish, deep tissue, and lymphatic-inspired techniques to provide safe, restorative sessions tailored to each client’s needs.</p>
      <p>Her goal is simple: help you feel revived — whether recovering, managing daily stress, or seeking radiant relaxation.</p>
    </div>
  </div>
</section>

<section id="booking" class="container fadein">
  <h2>Book an Appointment</h2>
  <div class="sub">Pick a date, choose a time, select a service, and enter your email. You’ll get a confirmation instantly.</div>

  <div class="card" style="margin-top:14px">
    <div id="calendar" class="calendar"></div>

    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">
      <label>Time
        <select id="time" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
          <option value="">Select a time</option>
        </select>
      </label>
      <label>Service
        <select id="service" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
          <option value="Gentle Recovery Flow (60 min)">$75 — Gentle Recovery Flow (60 min)</option>
          <option value="Total Body Renewal (60 min)">$70 — Total Body Renewal (60 min)</option>
          <option value="Radiance Facial Flow (45 min)">$55 — Radiance Facial Flow (45 min)</option>
        </select>
      </label>
      <label>Contact Email
        <input id="clientEmail" type="email" placeholder="you@example.com" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
      </label>
    </div>

    <!-- New row: Name + Location choice + Address (for mobile) -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">
      <label>Your Name (optional)
        <input id="clientName" type="text" placeholder="Jane Doe" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
      </label>
      <label>Location
        <select id="location" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
          <option value="studio">In-studio (no travel fee)</option>
          <option value="mobile">Mobile visit (travel fee applies)</option>
        </select>
      </label>
      <label id="addrWrap" style="display:none">Address (for mobile visit)
        <input id="clientAddress" type="text" placeholder="Street, City" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
      </label>
    </div>
    <div id="travelNote" class="small" style="display:none;color:#b45309;margin-top:6px">
      * Mobile visits include a flat <strong>$15 travel fee</strong>. See <a href="/policies.html">Policies</a>.
    </div>

    <div style="margin-top:12px">
      <button id="requestBtn" class="btn primary">Request Booking</button>
      <span id="reqMsg" class="small" style="margin-left:10px;color:#6b7280"></span>
    </div>

    <div class="cal-legend">
      <span><span class="chip ok"></span>Available</span>
      <span><span class="chip no"></span>Unavailable</span>
    </div>
  </div>
</section>

<section id="contact" class="container fadein">
<!-- Google Maps Embed & Testimonials -->
<section id="location-map" class="container fadein" style="padding-top: 40px; padding-bottom: 40px;">
  <h2>Our Location</h2>
  <div class="card" style="overflow:hidden;padding:0;">
    <iframe
      title="Google Map location"
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3170.187393137469!2d-121.88701078469256!3d37.36691267983745!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x808fccf6a1f6d9f3%3A0x6d6e3f51e1f2a9f2!2s1265%20N%20Capitol%20Ave%2C%20San%20Jose%2C%20CA%2095132!5e0!3m2!1sen!2sus!4v1686698890102!5m2!1sen!2sus"
      width="100%"
      height="340"
      style="border:0;"
      allowfullscreen=""
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
    ></iframe>
    <div class="small" style="padding: 14px 18px;">
      1265 N Capitol Ave, San Jose, CA 95132
    </div>
  </div>
</section>

<section id="testimonials" class="container testimonials fadein">
  <h2>What Clients Say</h2>
  <div class="testimonials-grid">
    <div class="card">
      <div class="testimonial-quote">“Lize is gentle, attentive, and truly cares about your healing. I left feeling lighter and more relaxed than I have in months.”</div>
      <div class="testimonial-author">— Maria G.</div>
    </div>
    <div class="card">
      <div class="testimonial-quote">“The Total Body Renewal was exactly what I needed after a stressful week. The environment is calming and Lize’s touch is magic.”</div>
      <div class="testimonial-author">— James L.</div>
    </div>
    <div class="card">
      <div class="testimonial-quote">“I had post-surgery swelling and discomfort. Lize’s massage helped so much with my recovery. Highly recommend!”</div>
      <div class="testimonial-author">— Priya S.</div>
    </div>
  </div>
</section>
  <h2>Contact & Location</h2>
  <div class="card">
    <p><strong>Email:</strong> <a href="mailto:contact@revivebylize.com">contact@revivebylize.com</a></p>
    <p><strong>Hours:</strong> Evenings & Weekends • By appointment</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn secondary" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?api=1&query=1265+N+Capitol+Ave%2C+San+Jose%2C+CA+95132">Open in Google Maps</a>
      <a class="btn secondary" target="_blank" rel="noopener" href="http://maps.apple.com/?q=1265+N+Capitol+Ave%2C+San+Jose%2C+CA+95132">Open in Apple Maps</a>
    </div>
  </div>
</section>

<footer>
<!-- Sticky Book Now Button -->
<button
  class="booknow-fab"
  onclick="document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });"
  aria-label="Book Now"
>
  Book Now
</button>
  <div class="container">
    <div class="footer-grid">
      <div>
        <div class="name" style="font-weight:700">Revive by Lize</div>
        <div class="small">Massage therapy for healing, renewal, and radiant relaxation.</div>
      </div>
      <div>
        <div class="small"><strong>Quick links</strong></div>
        <div class="small"><a href="#services">Services</a> · <a href="#about">About</a> · <a href="#booking">Book</a> · <a href="/policies.html">Policies</a> · <a href="#contact">Contact</a></div>
      </div>
      <div>
        <div class="small"><strong>Payments</strong></div>
        <div class="small">Zelle • Cash (in person)</div>
      </div>
    </div>
    <div class="credits">© <span id="year"></span> Revive by Lize</div>
  </div>
</footer>

<script>
// ==== Footer year (safe) ====
const yearEl = document.getElementById('year');
if (yearEl) yearEl.textContent = new Date().getFullYear();

// ==== Booking: custom calendar + API calls ====
const SERVICE_LABELS = [
  "Gentle Recovery Flow (60 min)",
  "Total Body Renewal (60 min)",
  "Radiance Facial Flow (45 min)"
];

const calEl   = document.getElementById('calendar');
const timeSel = document.getElementById('time');
const svcSel  = document.getElementById('service');
const reqBtn  = document.getElementById('requestBtn');
const reqMsg  = document.getElementById('reqMsg');
const emailEl = document.getElementById('clientEmail');
const nameEl = document.getElementById('clientName');
const locSel = document.getElementById('location');
const addrWrap = document.getElementById('addrWrap');
const addrEl = document.getElementById('clientAddress');
const travelNote = document.getElementById('travelNote');

const TZ = 'America/Los_Angeles';
function fmtPT(iso) {
  return new Date(iso).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', timeZone: TZ });
}

if (locSel) {
  const syncLocUI = ()=>{
    const mobile = locSel.value === 'mobile';
    if (addrWrap) addrWrap.style.display = mobile ? '' : 'none';
    if (travelNote) travelNote.style.display = mobile ? '' : 'none';
  };
  locSel.addEventListener('change', syncLocUI);
  // initialize on load
  syncLocUI();
}

if (calEl && timeSel && svcSel && reqBtn && reqMsg) {
  let view = new Date();
  let selectedDateISO = null;

  const ymd = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

  function renderCalendar(){
    calEl.innerHTML = "";

    const head = document.createElement('div');
    head.className = "cal-head";
    head.innerHTML = `
      <button class="btn secondary" id="prev">&larr;</button>
      <div style="font-weight:700">${view.toLocaleString('default',{month:'long',year:'numeric'})}</div>
      <button class="btn secondary" id="next">&rarr;</button>
    `;
    calEl.appendChild(head);

    const labels = document.createElement('div');
    labels.className = "cal-grid";
    ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(txt=>{
      const el = document.createElement('div'); el.className = "dow"; el.textContent = txt; labels.appendChild(el);
    });
    calEl.appendChild(labels);

    const grid = document.createElement('div');
    grid.className = "cal-grid";

    const first = new Date(view.getFullYear(), view.getMonth(), 1);
    const startIdx = first.getDay();
    const daysInMonth = new Date(view.getFullYear(), view.getMonth()+1, 0).getDate();

    for(let i=0;i<startIdx;i++){ const b=document.createElement('div'); b.className="day muted"; grid.appendChild(b); }

    for(let d=1; d<=daysInMonth; d++){
      const date = new Date(view.getFullYear(), view.getMonth(), d);
      const today = new Date(new Date().toDateString());
      const future = date >= today;

      const el = document.createElement('div');
      el.className = "day " + (future ? "ok" : "no");
      if (future) { el.dataset.date = ymd(date); }
      el.textContent = d;

      if (future){
        el.addEventListener('click', async ()=>{
          [...grid.querySelectorAll('.day')].forEach(x=>x.classList.remove('selected'));
          el.classList.add('selected');
          selectedDateISO = ymd(date);
          await loadTimesFor(selectedDateISO, el);
        });
      } else {
        el.style.cursor = "not-allowed";
      }

      grid.appendChild(el);
    }

    calEl.appendChild(grid);
    document.getElementById('prev').onclick = ()=>{ view.setMonth(view.getMonth()-1); renderCalendar(); };
    document.getElementById('next').onclick = ()=>{ view.setMonth(view.getMonth()+1); renderCalendar(); };

    // Color each future day based on API (full-day availability)
    (async function markMonthAvailability(){
      const cells = grid.querySelectorAll('.day[data-date]');
      for (const cell of cells) {
        const dISO = cell.dataset.date;
        try{
          const url = `/api/freebusy?date=${encodeURIComponent(dISO)}&service=${encodeURIComponent(svcSel.value)}`;
          const resp = await fetch(url);
          const data = await resp.json();
          cell.classList.remove('ok', 'no');
          if (data.fullDayBlocked || !Array.isArray(data.slots) || data.slots.length === 0) {
            cell.classList.add('no');
          } else {
            cell.classList.add('ok');
          }
        } catch(e) {
          cell.classList.remove('ok');
          cell.classList.add('no');
        }
      }
    })();
  }

  async function loadTimesFor(dateISO, dayEl){
    if (!SERVICE_LABELS.includes(svcSel.value)) svcSel.value = SERVICE_LABELS[0];
    timeSel.innerHTML = '<option value="">Loading…</option>';
    try{
      const url = `/api/freebusy?date=${encodeURIComponent(dateISO)}&service=${encodeURIComponent(svcSel.value)}`;
      const r = await fetch(url);
      const data = await r.json();
      const slots = Array.isArray(data.slots) ? data.slots : [];
      if (dayEl) {
        dayEl.classList.remove('ok', 'no');
        if (data.fullDayBlocked || slots.length === 0) {
          dayEl.classList.add('no');
        } else {
          dayEl.classList.add('ok');
        }
      }
      timeSel.innerHTML = '<option value="">Select a time</option>';
      if (!slots.length){
        const o = document.createElement('option');
        o.value = ""; o.textContent = "No times available";
        timeSel.appendChild(o);
        return;
      }
      slots.forEach(iso=>{
        const t = fmtPT(iso);
        const o = document.createElement('option'); o.value = iso; o.textContent = t; timeSel.appendChild(o);
      });
    }catch(err){
      timeSel.innerHTML = '<option value="">Error loading times</option>';
      console.error('freebusy error', err);
    }
  }

  svcSel.addEventListener('change', ()=>{
    if (selectedDateISO) loadTimesFor(selectedDateISO, calEl.querySelector('.day.selected'));
    // Re-render calendar to recolor days for the new service duration/logic
    renderCalendar();
  });

  reqBtn.addEventListener('click', async ()=>{
    reqMsg.textContent = "";
    const isoStart = timeSel.value;
    const service  = svcSel.value;
    const email    = (emailEl.value || "").trim();
    const name     = (nameEl && nameEl.value || "").trim();
    const locationChoice = (locSel && locSel.value) || "studio";
    const clientAddress  = (addrEl && addrEl.value || "").trim();
    if (locationChoice === 'mobile' && !clientAddress){
      reqMsg.textContent = "Please enter an address for a mobile visit.";
      return;
    }

    if (!selectedDateISO){ reqMsg.textContent = "Please pick a date."; return; }
    if (!isoStart){ reqMsg.textContent = "Please pick a time."; return; }
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ reqMsg.textContent = "Enter a valid email."; return; }

    reqBtn.disabled = true; const old = reqBtn.textContent; reqBtn.textContent = "Booking…";

    try{
      const r = await fetch('/api/book',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ isoStart, service, name, email, location: locationChoice, address: clientAddress })
      });
      const data = await r.json();
      if (data && data.ok){
        reqMsg.style.color = "#16a34a";
        reqMsg.textContent = "Booked! A confirmation email was sent to you.";
      } else {
        reqMsg.style.color = "#ef4444";
        reqMsg.textContent = "Booking failed. Please try again.";
      }
    }catch(err){
      reqMsg.style.color = "#ef4444";
      reqMsg.textContent = "Network error. Please try again.";
      console.error('book error', err);
    }finally{
      reqBtn.disabled = false; reqBtn.textContent = old;
    }
  });

  // go!
  renderCalendar();
} else {
  console.warn('Booking elements not found; calendar not initialized.');
}
// ==== View-more toggles for service cards ====
document.querySelectorAll('.view-more').forEach((btn, idx)=>{
  btn.addEventListener('click', ()=>{
    const card = btn.closest('.card');
    const more = card && card.querySelector('.more');
    if (!more) return;
    const open = more.style.display !== 'none';
    more.style.display = open ? 'none' : '';
    btn.textContent = open ? 'View more' : 'View less';
  });
});

// Fade-in animation on scroll
function fadeInOnScroll() {
  const fadeEls = document.querySelectorAll('.fadein, .testimonials .card');
  const windowHeight = window.innerHeight;
  fadeEls.forEach(el => {
    const rect = el.getBoundingClientRect();
    if (rect.top < windowHeight - 60) {
      el.style.opacity = 1;
      el.style.animationPlayState = 'running';
    }
  });
}
window.addEventListener('scroll', fadeInOnScroll);
window.addEventListener('DOMContentLoaded', fadeInOnScroll);
</script>
</body>
</html>

